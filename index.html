<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>生活助手</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://via.placeholder.com/180/8D6E63/FFFFFF?text=MUJI">

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #F7F3F0; color: #5D4037; }
        .muji-card { background-color: #FFFFFF; border-radius: 20px; box-shadow: 0 4px 12px rgba(93, 64, 55, 0.05); }
        .muji-btn { background-color: #8D6E63; color: white; transition: all 0.2s; }
        .tab-active { border-bottom: 2px solid #8D6E63; color: #8D6E63; font-weight: 500; }
        input, select, textarea { background-color: #FBF9F7; border: 1px solid #EFEBE9; border-radius: 12px; padding: 12px; outline: none; width: 100%; }
        .animate-fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="max-w-md mx-auto min-h-screen relative pb-24">

<div id="app">
    <header class="bg-white px-6 pt-6 sticky top-0 z-20 shadow-sm">
        <div class="flex justify-between items-center mb-4">
            <div>
                <h1 class="text-xl font-medium">健康日誌</h1>
                <p class="text-[10px] opacity-50">節氣與生活紀錄</p>
            </div>
            <div class="text-right">
                <div class="text-sm font-bold text-[#8D6E63]">{{ currentTerm }}</div>
                <div class="text-[10px] opacity-60">{{ currentDate }}</div>
            </div>
        </div>
        <div class="flex gap-6 text-sm text-stone-400 pb-2">
            <span @click="tab = 'recommend'" :class="{'tab-active': tab === 'recommend'}" class="cursor-pointer pb-2">今日建議</span>
            <span @click="tab = 'health'" :class="{'tab-active': tab === 'health'}" class="cursor-pointer pb-2">健康狀態</span>
            <span @click="tab = 'recipes'" :class="{'tab-active': tab === 'recipes'}" class="cursor-pointer pb-2">食譜日誌</span>
        </div>
    </header>

    <section v-if="tab === 'recommend'" class="p-6 space-y-6 animate-fade-in">
        <div class="bg-[#EAE3DB] p-6 rounded-[30px] relative overflow-hidden">
            <h2 class="text-lg font-bold mb-2">節氣養生：{{ currentTerm }}</h2>
            <p class="text-sm leading-relaxed opacity-80">{{ termInfo.intro }}</p>
        </div>

        <div class="space-y-4">
            <h3 class="text-xs font-bold tracking-widest opacity-50">推薦食補</h3>
            <div v-for="tonic in termInfo.tonics" class="muji-card p-4 flex gap-4 items-center">
                <div class="w-10 h-10 muji-btn rounded-full flex items-center justify-center flex-shrink-0 text-xs">
                    <i class="fas fa-leaf"></i>
                </div>
                <div>
                    <div class="font-medium text-sm">{{ tonic.name }}</div>
                    <div class="text-[11px] opacity-60">{{ tonic.desc }}</div>
                </div>
            </div>
        </div>

        <div class="space-y-4">
            <h3 class="text-xs font-bold tracking-widest opacity-50">今日健康中菜</h3>
            <div v-for="dish in termInfo.dishes" class="muji-card p-4 flex justify-between items-center">
                <div>
                    <div class="font-medium text-sm">{{ dish.name }}</div>
                    <div class="text-[10px] opacity-50">{{ dish.tag }}</div>
                </div>
                <div class="text-xs font-bold text-[#8D6E63]">{{ dish.cal }} kcal</div>
            </div>
        </div>
    </section>

    <section v-if="tab === 'health'" class="p-6 space-y-6 animate-fade-in">
        <div class="muji-card p-6">
            <h2 class="text-lg mb-4 flex items-center"><i class="fas fa-weight-hanging mr-2"></i>BMI 計算機</h2>
            <div class="grid grid-cols-2 gap-4 mb-4">
                <input v-model.number="user.height" type="number" placeholder="身高 (cm)">
                <input v-model.number="user.weight" type="number" placeholder="體重 (kg)">
            </div>
            <div class="flex gap-2 mb-6">
                <button @click="user.gender = 'M'" :class="user.gender === 'M' ? 'muji-btn' : 'bg-stone-100'" class="flex-1 py-2 rounded-xl text-xs">成年男性</button>
                <button @click="user.gender = 'F'" :class="user.gender === 'F' ? 'muji-btn' : 'bg-stone-100'" class="flex-1 py-2 rounded-xl text-xs">成年女性</button>
            </div>
            <div v-if="bmi" class="text-center p-5 bg-stone-50 rounded-2xl">
                <div class="text-xs opacity-50">您的指數為</div>
                <div class="text-4xl font-light my-2">{{ bmi }}</div>
                <div class="text-xs font-medium px-4 py-1 inline-block rounded-full bg-white shadow-sm">{{ bmiStatus }}</div>
            </div>
        </div>
        <div v-if="bmi" class="muji-card p-6 bg-[#FDFCFB]">
            <h3 class="font-bold text-sm mb-2">飲食建議</h3>
            <p class="text-sm opacity-80 leading-relaxed">{{ healthAdvice }}</p>
        </div>
    </section>

    <section v-if="tab === 'recipes'" class="p-6 space-y-4 animate-fade-in">
        <div v-if="recipes.length === 0" class="text-center py-20 opacity-30">
            <i class="fas fa-camera-retro text-4xl mb-2"></i>
            <p>點擊下方按鈕紀錄第一道菜</p>
        </div>
        <div v-for="(recipe, index) in recipes" :key="index" class="muji-card overflow-hidden">
            <img :src="recipe.image" class="w-full h-48 object-cover" v-if="recipe.image">
            <div class="p-4">
                <div class="flex justify-between items-start">
                    <h3 class="font-medium">{{ recipe.title }}</h3>
                    <span class="text-[10px] bg-stone-100 px-2 py-0.5 rounded">{{ recipe.cuisine }}</span>
                </div>
                <div class="mt-2 text-xs text-[#8D6E63] font-bold">{{ recipe.calories }} kcal</div>
            </div>
        </div>
    </section>

    <button @click="showModal = true" class="fixed bottom-8 right-8 w-14 h-14 muji-btn rounded-full shadow-2xl flex items-center justify-center z-30">
        <i class="fas fa-plus"></i>
    </button>

    <div v-if="showModal" class="fixed inset-0 bg-black/50 z-50 flex items-end">
        <div class="bg-white w-full rounded-t-[30px] p-8 max-h-[85vh] overflow-y-auto">
            <div class="flex justify-between mb-6">
                <h2 class="font-bold">新增食譜</h2>
                <button @click="showModal = false" class="text-2xl">&times;</button>
            </div>
            <div class="space-y-4">
                <input v-model="newRecipe.title" type="text" placeholder="食譜名稱">
                <input v-model.number="newRecipe.calories" type="number" placeholder="卡路里">
                <div class="flex items-center justify-between p-4 bg-stone-50 rounded-xl">
                    <span class="text-sm opacity-60">相片</span>
                    <input type="file" @change="handleFileUpload" class="w-auto opacity-0 absolute" id="upload">
                    <label for="upload" class="muji-btn px-4 py-2 rounded-lg text-xs cursor-pointer">選擇/拍照</label>
                </div>
                <button @click="saveRecipe" class="w-full py-4 muji-btn rounded-xl font-medium">儲存</button>
            </div>
        </div>
    </div>
</div>

<script>
const { createApp, ref, computed } = Vue
createApp({
    setup() {
        const tab = ref('recommend')
        const showModal = ref(false)
        const recipes = ref(JSON.parse(localStorage.getItem('muji_recipes') || '[]'))
        const user = ref({ height: '', weight: '', gender: 'F' })
        const newRecipe = ref({ title: '', calories: '', image: '', cuisine: '中式' })

        // 24節氣計算邏輯
        const getSolarTerm = () => {
            const now = new Date();
            const m = now.getMonth() + 1;
            const d = now.getDate();
            const terms = ["小寒","大寒","立春","雨水","驚蟄","春分","清明","穀雨","立夏","小滿","芒種","夏至","小暑","大暑","立秋","處暑","白露","秋分","寒露","霜降","立冬","小雪","大雪","冬至"];
            const dates = [5,20,4,19,5,20,4,20,5,21,5,21,7,22,7,23,7,23,8,23,7,22,7,21];
            let i = (m-1)*2;
            if (d >= dates[i+1]) i += 1;
            else if (d < dates[i]) i -= 1;
            return terms[i < 0 ? 23 : i];
        }

        const currentTerm = ref(getSolarTerm())
        const currentDate = ref(new Date().toLocaleDateString('zh-HK'))

        // 節氣詳細資料庫
        const termDatabase = {
            "大雪": { 
                intro: "大雪時節，氣候寒冷。應注意保暖，保護關節，飲食宜溫補。",
                tonics: [{name:"當歸紅棗茶", desc:"補血驅寒，溫暖手腳。"},{name:"黑豆芝麻糊", desc:"補腎強身，對抗寒冷。"}],
                dishes: [{name:"清燉蘿蔔牛腩", tag:"消食暖胃", cal:450},{name:"薑蔥蒸鱸魚", tag:"高蛋白溫補", cal:280}]
            },
            "冬至": { 
                intro: "冬至是一年中黑夜最長的一天，象徵陽氣回升。宜進補，護陽氣。",
                tonics: [{name:"花膠雞湯", desc:"滋陰養顏，增強體力。"},{name:"糯米紅棗粥", desc:"健脾暖身。"}],
                dishes: [{name:"麻油雞", tag:"補氣活血", cal:550},{name:"素炒時蔬", tag:"平衡油膩", cal:120}]
            },
            // 其他節氣會顯示預設建議
        }

        const termInfo = computed(() => termDatabase[currentTerm.value] || {
            intro: `現在是${currentTerm.value}，宜早睡早起，飲食均衡，保持心情舒暢。`,
            tonics: [{name:"時令熱湯", desc:"溫潤身心。"},{name:"蜂蜜水", desc:"潤燥養顏。"}],
            dishes: [{name:"清炒時蔬", tag:"低卡健康", cal:150},{name:"清蒸魚", tag:"優質蛋白", cal:220}]
        })

        // BMI 邏輯
        const bmi = computed(() => {
            if (!user.value.height || !user.value.weight) return null
            return (user.value.weight / Math.pow(user.value.height/100, 2)).toFixed(1)
        })

        const bmiStatus = computed(() => {
            if (bmi.value < 18.5) return '體重過輕'
            if (bmi.value < 24) return '健康標準'
            return '過重 / 肥胖'
        })

        const healthAdvice = computed(() => {
            if (!bmi.value) return ''
            const genderText = user.value.gender === 'M' ? '成年男性' : '成年女性'
            const base = `作為${genderText}，`
            if (bmi.value < 18.5) return base + '您的攝取量偏低。建議增加蛋白質攝取，如雞蛋、牛肉，並配合規律運動。'
            if (bmi.value < 24) return base + '目前的狀態非常理想！請繼續保持高纖、低鹽、低糖的無印飲食生活。'
            return base + '建議控制每餐澱粉量，增加膳食纖維。中菜方面多選清蒸，少選油炸，並每日快走 30 分鐘。'
        })

        const handleFileUpload = (e) => {
            const file = e.target.files[0]
            const reader = new FileReader()
            reader.onload = (ev) => newRecipe.value.image = ev.target.result
            reader.readAsDataURL(file)
        }

        const saveRecipe = () => {
            if (!newRecipe.value.title) return alert('請輸入菜名')
            recipes.value.unshift({...newRecipe.value})
            localStorage.setItem('muji_recipes', JSON.stringify(recipes.value))
            showModal.value = false
            newRecipe.value = { title: '', calories: '', image: '', cuisine: '中式' }
        }

        return { tab, showModal, recipes, user, newRecipe, currentTerm, currentDate, termInfo, bmi, bmiStatus, healthAdvice, handleFileUpload, saveRecipe }
    }
}).mount('#app')
</script>
</body>
</html>